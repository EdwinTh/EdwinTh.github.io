<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<head></head>
<title>Here is the new padr &#8211; That's so Random</title>
<meta name="description" content="I am very happy to announce v0.3.0 of the padr package, which was introduced in January. As requested by many, you are now able to use intervals of which the unit is different from 1. In earlier version the eight interval values only allowed for a single unit (e.g. year, day, hour). Now you can use any time period that is accepted by seq.Date or seq.POSIXt (e.g. 2 months, 6 hours, 5 minutes) in both thicken and pad. get_interval does test for both the interval and the unit of the interval of the datetime variable from now on.

">
<meta name="keywords" content="R, tidyverse, padr, datetime">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Here is the new padr">
<meta name="twitter:description" content="I am very happy to announce v0.3.0 of the padr package, which was introduced in January. As requested by many, you are now able to use intervals of which the unit is different from 1. In earlier version the eight interval values only allowed for a single unit (e.g. year, day, hour). Now you can use any time period that is accepted by seq.Date or seq.POSIXt (e.g. 2 months, 6 hours, 5 minutes) in both thicken and pad. get_interval does test for both the interval and the unit of the interval of the datetime variable from now on.

">
<meta name="twitter:site" content="@edwin_thoen">
<meta name="twitter:creator" content="@edwin_thoen">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://EdwinTh.github.io/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Here is the new padr">
<meta property="og:description" content="I am very happy to announce v0.3.0 of the padr package, which was introduced in January. As requested by many, you are now able to use intervals of which the unit is different from 1. In earlier version the eight interval values only allowed for a single unit (e.g. year, day, hour). Now you can use any time period that is accepted by seq.Date or seq.POSIXt (e.g. 2 months, 6 hours, 5 minutes) in both thicken and pad. get_interval does test for both the interval and the unit of the interval of the datetime variable from now on.

">
<meta property="og:url" content="https://EdwinTh.github.io/blog/padr-v0-3-0/">
<meta property="og:site_name" content="That's so Random">





<link rel="canonical" href="https://EdwinTh.github.io/blog/padr-v0-3-0/">
<link href="https://EdwinTh.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="That's so Random Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://EdwinTh.github.io/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://EdwinTh.github.io/assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://EdwinTh.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://EdwinTh.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://EdwinTh.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://EdwinTh.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://EdwinTh.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://EdwinTh.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://EdwinTh.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://EdwinTh.github.io/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="https://EdwinTh.github.io/about/" >About</a></li>
		  
		    
		    <li><a href="https://EdwinTh.github.io/blog/" >Blog</a></li>
		  
		    
		    <li><a href="https://EdwinTh.github.io/blogs-I-read/" >Blogs I read</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="https://EdwinTh.github.io/" class="site-logo" rel="home" title="That's so Random"><img src="https://EdwinTh.github.io/images/site-logo.png" width="200" height="200" alt="That's so Random logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="https://EdwinTh.github.io/">That's so Random</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">A playground for data analysis and R programming.</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="https://EdwinTh.github.io/tags/#R" title="Pages tagged R">R</a></li><li><a href="https://EdwinTh.github.io/tags/#tidyverse" title="Pages tagged tidyverse">tidyverse</a></li><li><a href="https://EdwinTh.github.io/tags/#padr" title="Pages tagged padr">padr</a></li><li><a href="https://EdwinTh.github.io/tags/#datetime" title="Pages tagged datetime">datetime</a></li>
        </ul>
        
          <h1 class="entry-title">Here is the new padr</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="https://EdwinTh.github.io/images/bio-photo.jpg" class="bio-photo" alt="Edwin Thoen bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Edwin Thoen</span></span>
        <span class="entry-date date published"><time datetime="2017-05-16T21:00:00+02:00"><i class="fa fa-calendar-o"></i> May 16, 2017</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
      </footer>
      <div class="entry-content">
        <p>I am very happy to announce v0.3.0 of the <code class="highlighter-rouge">padr</code> package, <a href="https://edwinth.github.io/blog/padr-intro/">which was introduced in January</a>. As requested by many, you are now able to use intervals of which the unit is different from 1. In earlier version the eight interval values only allowed for a single unit (e.g. year, day, hour). Now you can use any time period that is accepted by <code class="highlighter-rouge">seq.Date</code> or <code class="highlighter-rouge">seq.POSIXt</code> (e.g. 2 months, 6 hours, 5 minutes) in both <code class="highlighter-rouge">thicken</code> and <code class="highlighter-rouge">pad</code>. <code class="highlighter-rouge">get_interval</code> does test for both the interval and the unit of the interval of the datetime variable from now on.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">padr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">get_interval</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"2017-01-01"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2017-03-01"</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] "2 month"
</code></pre>
</div>

<p>With this new definition of the interval the possibilities of both <code class="highlighter-rouge">thicken</code> and <code class="highlighter-rouge">pad</code> are expanded. See the following analysis, where the new functionality is demonstrated by aggregating to daypart:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">emergency</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"EMS: CARDIAC EMERGENCY"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">thicken</span><span class="p">(</span><span class="n">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"6 hours"</span><span class="p">,</span><span class="w"> </span><span class="n">colname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"daypart"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">count</span><span class="p">(</span><span class="n">daypart</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">pad</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">fill_by_value</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">start_daypart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lubridate</span><span class="o">::</span><span class="n">hour</span><span class="p">(</span><span class="n">daypart</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">as.factor</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_density</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_daypart</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">start_daypart</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## pad applied on the interval: 6 hour
</code></pre>
</div>

<p><img src="/figure/source/2017-05-16-padr-v0-3-0/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /></p>

<p>The addition of unit specification to the interval made it unfortunately impossible to make v0.3.0 fully backwords compatible. The two main functions are affected in the the following way.</p>

<ul>
  <li>
    <p>In <code class="highlighter-rouge">thicken</code> the <code class="highlighter-rouge">interval</code> argument now has to be specified. In earlier versions it was optional. When it was not specified, the added variable was one interval level higher than that of the input datetime variable. With the widening of the interval definition, there is not longer a natural step up.</p>
  </li>
  <li>
    <p>When the <code class="highlighter-rouge">interval</code> argument is not specified in <code class="highlighter-rouge">pad</code>, <code class="highlighter-rouge">get_interval</code> is applied on the datetime variable. Since this function now returns the units additionally to the interval, padding might now be done at a different interval. In earlier versions, the following dataframe would have 7 rows after padding because the interval of <code class="highlighter-rouge">dt</code> used to be “month”. Now <code class="highlighter-rouge">pad</code> would return only 4 rows, because the new interval is “2 month”.</p>
  </li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">example_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"2017-01-01"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2017-03-01"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2017-07-01"</span><span class="p">)),</span><span class="w">
                         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">pad</span><span class="p">(</span><span class="n">example_df</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## pad applied on the interval: 2 month
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##           dt  y
## 1 2017-01-01  1
## 2 2017-03-01  2
## 3 2017-05-01 NA
## 4 2017-07-01  3
</code></pre>
</div>

<p>One should thus be a little more careful that there is no higher unit within the interval that explains the data as well. To reduce the risk of padding at the wrong unit, <code class="highlighter-rouge">pad</code> now always prints the interval at which the padding occured.</p>

<h2 id="reimplementation-of-pad">Reimplementation of <code class="highlighter-rouge">pad</code></h2>

<p>The second significant change in this version is the reimplementatiion of <code class="highlighter-rouge">pad</code>. Performance was poor when <code class="highlighter-rouge">pad</code> was applied on more than a handfull of groups. By leveraging <code class="highlighter-rouge">dplyr</code> this is now greatly improved.</p>

<p>Besides, functionality is slightly adjusted as well:</p>

<ul>
  <li>
    <p>When the <code class="highlighter-rouge">interval</code> argument is not specified and the <code class="highlighter-rouge">group</code> argument is specified, the interval is now determined on all observations instead of within each group separately. With the new definition of the interval it would far more likely that we get deviating intervals for small groups unintendedly. To prevent this kind of interval overfitting, groups are no longer taking into account when determining the interval.</p>
  </li>
  <li>
    <p>For better integration with <code class="highlighter-rouge">dplyr</code>, it is now possible to specifiy the grouping variable(s) for <code class="highlighter-rouge">pad</code> with <code class="highlighter-rouge">dplyr::group_by</code>. The following two are interchangeable:</p>
  </li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">emergency</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">thicken</span><span class="p">(</span><span class="s2">"day"</span><span class="p">,</span><span class="w"> </span><span class="s2">"d"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">pad</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"title"</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">pad</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<ul>
  <li>
    <p>Moreover, both <code class="highlighter-rouge">pad</code> and <code class="highlighter-rouge">thicken</code> now maintain <code class="highlighter-rouge">dplyr</code> grouping. The grouping of their outputs is equal to the grouping of the input.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">pad</code> has gained the <code class="highlighter-rouge">break_above</code> argument. This is a number in millions. Before starting to pad, the function makes an estimate of the number of returned rows. If the number of rows is above the number specified in <code class="highlighter-rouge">break_above</code> the function will break. This is a safety net for the situation where the interval of the datetime variable is more granualar than the user thinks it is. For instance, when forgetting to apply <code class="highlighter-rouge">thicken</code> first.</p>
  </li>
  <li>
    <p>For determining the interval in <code class="highlighter-rouge">pad</code> the <code class="highlighter-rouge">start_val</code> and/or the <code class="highlighter-rouge">end_val</code> are taken into account, if specified. They are concatenated to the datetime variable before the interval is determined.</p>
  </li>
</ul>

<h2 id="other-changes">Other changes</h2>

<ul>
  <li>
    <p>The new function <code class="highlighter-rouge">pad_int</code> pads an integer column, instead of a datetime column. Helpful for datasets where time is specified as just the years, but also for interger id variabels that are incomplete.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">fill_</code> used to require specification of all the column names that had to filled. This is annoying when many columns had to be filled. The functions no longer break when no variable names are specified, but instead fill all columns in the data frame.</p>
  </li>
  <li>
    <p>In <code class="highlighter-rouge">thicken</code> observations before the <code class="highlighter-rouge">start_val</code> are now removed from the dataset. They used to be all mapped to the <code class="highlighter-rouge">start_val</code>. The behavior of <code class="highlighter-rouge">thicken</code> is thereby consistent with the behavior of <code class="highlighter-rouge">pad</code>.</p>
  </li>
</ul>

<h2 id="bug-fixes">Bug fixes</h2>

<ul>
  <li>
    <p>When the <code class="highlighter-rouge">end_val</code> is specified in <code class="highlighter-rouge">pad</code>, it would mistakenly update the <code class="highlighter-rouge">start_val</code> with its value. This resulted in the return of only the last line of the padded data.frame, instead of the full padded data.frame. (#13)</p>
  </li>
  <li>
    <p>When dt_var has NULL as timezone, <code class="highlighter-rouge">to_posix</code> (helper of <code class="highlighter-rouge">round_thicken</code>, which itself is a helper of <code class="highlighter-rouge">thicken</code>) used to break, and thereby <code class="highlighter-rouge">thicken</code> itself broke. This is fixed. (#14)</p>
  </li>
  <li>
    <p>In <code class="highlighter-rouge">pad</code> with grouping, the function will no longer breaks if for one of the groups the <code class="highlighter-rouge">start_val</code> is behind its last observation, or the <code class="highlighter-rouge">end_val</code> is before its first observation. Group is omitted and warning is thrown. If all groups are omitted, function breaks with an informative error. The same goes of course when there is no grouping. (#24)</p>
  </li>
  <li>
    <p>Both <code class="highlighter-rouge">pad</code> and <code class="highlighter-rouge">thicken</code> now throw informative errors when the start_val or end_val (<code class="highlighter-rouge">pad</code> only) are of the wrong class.</p>
  </li>
</ul>


        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'thats-so-random'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://EdwinTh.github.io/blog/outlier-bin/" class="btn" title="Binning Outliers in a Histogram">Previous</a>
      
      
        <a href="https://EdwinTh.github.io/blog/data-quality-padr/" class="btn" title="Check Data Quality with padr">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2018 Edwin Thoen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/edwin_thoen" title="Edwin Thoen on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	<a href="https://linkedin.com/in/edwin-thoen-3139a131?trk=hp-identity-name" title="Edwin Thoen on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://stackoverflow.com/users/2119315/edwin" title="Edwin Thoen on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	
	
	<a href="https://github.com/EdwinTh" title="Edwin Thoen on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="https://EdwinTh.github.io/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://EdwinTh.github.io';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://EdwinTh.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://EdwinTh.github.io/assets/js/scripts.min.js"></script>




</body>
</html>
